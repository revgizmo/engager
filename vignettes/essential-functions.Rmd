---
title: "Essential Functions - Core Package Functionality"
author: "engager package"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Essential Functions - Core Package Functionality}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Overview

This vignette demonstrates the core functionality of the `engager` package using only the essential functions. After scope reduction, the package now exports **26 essential functions** focused on:

- **Transcript Processing**: Loading and processing Zoom transcripts
- **Privacy Protection**: Ensuring FERPA compliance and data privacy
- **Analysis**: Core engagement metrics and analysis
- **Name Matching**: Safe student name matching workflows

## Essential Functions

The package now exports these essential functions:

```{r essential-functions, results='asis', echo=FALSE}
library(engager)

# Try to derive exported functions dynamically; fall back to a curated list
safe_exports <- tryCatch(names(getNamespaceExports("engager")), error = function(e) character(0))
essential_functions <- setdiff(safe_exports, c("%>%"))

if (length(essential_functions) == 0) {
  # Fallback list aligned with current exported API
  essential_functions <- c(
    "load_zoom_transcript",
    "process_zoom_transcript",
    "consolidate_transcript",
    "summarize_transcript_files",
    "analyze_transcripts",
    "summarize_transcript_metrics",
    "ensure_privacy",
    "privacy_audit",
    "validate_privacy_compliance",
    "plot_users",
    "write_metrics"
  )
}

# Emit a markdown list with autolinkable inline code items
cat("Essential functions (", length(essential_functions), "):\n\n")
cat(paste0("- `", essential_functions, "()`"), sep = "\n")
```

## Core Workflow

### 1. Load and Process Transcript

```{r load-transcript}
# Load a sample transcript
transcript_file <- system.file("extdata/transcripts/GMT20240124-202901_Recording.transcript.vtt",
  package = "engager"
)

# Load the transcript
transcript <- load_zoom_transcript(transcript_file)
cat("Transcript loaded with", nrow(transcript), "comments\n")
```

### 2. Process with Privacy Protection

```{r process-transcript}
# Process transcript with privacy defaults
processed <- process_zoom_transcript(
  transcript_df = transcript,
  add_dead_air = TRUE,
  consolidate_comments = TRUE
)

cat("Processed transcript has", nrow(processed), "rows\n")
```

### 3. Analyze Engagement

```{r analyze-engagement}
# Analyze transcripts for engagement metrics
# Note: This would normally analyze actual transcript files
# For this example, we'll demonstrate the function call structure
cat("analyze_transcripts() would analyze all .vtt files in the specified folder\n")
cat("Function signature: analyze_transcripts(transcripts_folder, names_to_exclude, write, output_path)\n")
```

### 4. Privacy and Compliance

```{r privacy-compliance}
# Check privacy compliance with synthetic data
synthetic_data <- data.frame(
  name = c("Student A", "Student B", "Instructor"),
  message = c("Hello", "Good morning", "Welcome to class"),
  timestamp = c("00:01:00", "00:02:00", "00:00:30")
)

# Note: Privacy compliance functions would check for real names in data
cat("Privacy compliance functions validate that no real names are exposed\n")
cat("validate_privacy_compliance() and validate_ferpa_compliance() ensure FERPA compliance\n")
```

## Function Categories

### Transcript Processing
- `load_zoom_transcript()` - Load Zoom transcript files
- `process_zoom_transcript()` - Process and clean transcripts
- `consolidate_transcript()` - Consolidate consecutive comments
- `summarize_transcript_files()` - Summarize transcripts at file level

### Analysis
- `analyze_transcripts()` - Main analysis function
- `summarize_transcript_metrics()` - Calculate engagement metrics

### Privacy & Compliance
- `ensure_privacy()` - Apply privacy protection
- `privacy_audit()` - Audit privacy compliance
- `validate_privacy_compliance()` - Validate privacy settings

### Name Matching
<!-- The core name-matching helpers are currently internal/non-exported. Public workflows will be linked here when exported. -->

### Utilities
- `plot_users()` - Plot user engagement
- `write_metrics()` - Export metrics

## Benefits of Scope Reduction

1. **Focused Functionality**: Only essential functions are exported
2. **Easier Maintenance**: Smaller codebase to maintain
3. **Better User Experience**: Clear, focused API
4. **CRAN Ready**: Minimal function surface for submission
5. **Privacy First**: All functions prioritize data protection

## Next Steps

With the scope reduction complete, the package is now ready for:

1. **CRAN Submission**: Minimal, focused function set
2. **User Testing**: Clear, essential functionality
3. **Documentation Updates**: Focus on core workflows
4. **UX Simplification**: Streamlined user experience

The package now provides a clean, focused API for analyzing student engagement from Zoom transcripts while maintaining strong privacy protection and FERPA compliance.
